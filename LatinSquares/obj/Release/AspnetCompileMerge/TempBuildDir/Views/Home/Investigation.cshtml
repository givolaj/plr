<style>
    .margin-bottom-10 {
        margin-bottom: 10px;
    }

    input.error {
        border: 1px solid red;
    }

    .form-group > label {
        font-size: 14px !important;
    }

    #error {
        color: #bb5588;
        margin-top: 10px;
    }

    #initialSquareDiv {
        width: 100% !important;
        margin-bottom: 10px;
    }
    .margin-left-10{
        margin-left: 10px;
    }
    #squareInput {
        margin-bottom: 10px;
    }
    #tripletsDiv {
        width: 100% !important;
        min-height: 250px;
        overflow: auto;
        margin-bottom: 10px;
    }

</style>
<div class="jumbotron">
    <h1>PLR Investigation</h1>
    <p>investigate a PLR, see if it's guilty.</p>
</div>
<div class="row">

    <div class="col-md-3">
        <h2>The rectangle</h2>
        <label>Click 'PLR' to generate a rectangle, 'Edit' to edit it, and 'Go' to start the investigation. Good luck!</label>
        <hr />
        <div id="initialSquareDiv"><pre>your PLR will appear here</pre></div>
        <div><textarea rows="5" class="form-control hidden" id="squareInput"></textarea></div>
        <button class="btn btn-primary btn-lg pull-left" id="randomSquareBtn">PLR</button>    
        <button class="btn btn-success btn-lg pull-left margin-left-10" id="editBtn">Edit</button> 
        <button class="btn btn-info btn-lg pull-left margin-left-10" id="goBtn">Go</button> 
    </div>

    <div class="col-md-5 hidden" id="tripletsRow">
        <h2>Strong Entry Invariant</h2>
        <label>we're counting non empty cells in rows, columns, and no. of symbols in the whole PLR, into these triplets, which allow us to extract an ER with which we can further investigate. </label>
        <hr />
        <div id="tripletsDiv"></div>
        <button class="hidden btn btn-primary btn-lg pull-left" id="tripletsIncreaseFontSize"><i class="glyphicon glyphicon-plus"></i></button>
        <button class="hidden btn btn-default btn-lg pull-right" id="tripletsDecreaseFontSize"><i class="glyphicon glyphicon-minus"></i></button>
    </div>

    <div class="col-md-4 hidden" id="ERRow">
        <h2>Basic Partitions</h2>
        <label>We're calculating partitions from the strong entry invariant matrix by counting non-empty indices in row and column and number of symbols in matrix<br /> </label>
        <hr />
        <div id="ERDiv"></div>
    </div>
</div>

@section scripts{
    <script>
        $(document).ready(function () {          
            $("#randomSquareBtn").click(function () {
                $.ajax({
                    url: "/api/GetNonTrivialRectangles?howMany=1", //"/api/GetFullRectangle?rows=" + 5 + "&cols=" + 5 + "&symbols=" + 5 + "&count=" + 23
                    type: "get",
                    success: function (data) {
                        $("#initialSquareDiv").html("<pre><code>" + data + "</code></pre>");
                    },
                    error: function (err) {
                        console.log(err);
                    }
                });
            });

            $("#squareInput").on("input", function (e) {
                let val = $("#squareInput").val();
                val = val.replaceAll("] [", "]\n[");
                $("#initialSquareDiv").html("<pre><code>" + val + "</code></pre>");
            });

            $("#editBtn").click(function () {
                $("#squareInput").toggleClass("hidden");
            });

            $("#goBtn").click(function () {
                $("#tripletsRow").removeClass("hidden");
                let squareString = $("#initialSquareDiv").text();
                $("#ERRow").removeClass("hidden");
                console.log(squareString);
                $.ajax({
                    url: "/api/GetInvestigationObjectForRectangle?&squareString=" + squareString,
                    type: "get",
                    success: function (data) {
                        console.log(data);
                        let obj = JSON.parse(data);
                        $("#tripletsDiv").html("<div>" + obj.triplets + "</div><div style='margin-top:10px;'>" + obj.indexedTriplets + "</div>");
                        $("#ERDiv").html("<pre><code>" + "rows: " + obj.partitions["rows"] +
                            "\ncolumns: " + obj.partitions["cols"] +
                            "\nsymbols: " + obj.partitions["symbols"] + "</code></pre>");
                    },
                    error: function (err) {
                        console.log(err);
                    }
                });
                
               /* $.ajax({
                    url: "/api/GetAtp?&squareString=" + squareString,
                    type: "get",
                    success: function (data) {
                        console.log(data);
                        $("#ERDiv").html("<pre><code>" + data.replaceAll(";", "<br/>") + "</code></pre>");
                    },
                    error: function (err) {
                        console.log(err);
                    }
                });*/

            });


            $("#tripletsIncreaseFontSize").click(function () {
                var fontSize = parseInt($("#tripletsDiv").find("code").css("font-size"));
                fontSize = fontSize + 1 + "px";
                $("#tripletsDiv").find("code").css({'font-size':fontSize});
            });

            $("#tripletsDecreaseFontSize").click(function () {
                var fontSize = parseInt($("#tripletsDiv").find("code").css("font-size"));
                fontSize = fontSize - 1 + "px";
                $("#tripletsDiv").find("code").css({ 'font-size': fontSize });
            });

            $("#initialSquareDiv").click(function () {
                
            });

        });
    </script>
}





