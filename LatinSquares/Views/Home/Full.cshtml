<style>
    .margin-bottom-10 {
        margin-bottom: 10px;
    }

    input.error {
        border: 1px solid red;
    }

    .form-group > label {
        font-size: 14px !important;
    }
    #error {
        color: #bb5588;
        margin-top: 10px;
    }
</style>
<div class="jumbotron">
    <h1>
        Full PLRs <a href="/home/documentation/#full"><i class="glyphicon glyphicon-question-sign"></i></a>
        <img alt="sudoku" src="~/Content/full.gif" class="inline" style="border-radius: 20px; height: 200px; width: auto; float: right; margin: 0px 0px 0px 20px;" />
    </h1>
    <p>
        We take full latin rectangles generated randomly with the Jacobson-Matthews algorithm, and remove values at random locations, to generate the matrices on this page
    </p>
</div>
<div class="row text-div">
    <div class="col-md-6 col-xs-12">
        <h2>Parameters</h2>
        <label>Fill out parametes and click 'Generate'.<br /> Minimum value for all fields is 2, Maximum is 36. Other values may behave unpredictably. <br />Number of symbols can't be smaller than rows and columns.</label>
        <hr />

        <div class="form-group">
            <label for="rows">Rows</label>
            <input class="form-control margin-bottom-10" type="number" id="rows" placeholder="rows (2-36)" />

            <label for="cols">Columns</label>
            <input class="form-control margin-bottom-10" type="number" id="cols" placeholder="columns (2-36)" />

            <label for="symbols">Number of Symbols in language</label>
            <input class="form-control margin-bottom-10" type="number" id="symbols" placeholder="Number of Symbols in language (2-36)" />

            <label for="count">Number of non empty entries</label>
            <input class="form-control margin-bottom-10" type="number" id="count" placeholder="Number of symbols in matrix (max: rows * cols)" />

            <label for="countPercent">Percent of non empty entries</label>
            <div>
                <input class="margin-bottom-10" type="range" id="countPercent" min="0" max="100" value="0" />
                <p style="text-align: center; width: 100%;" id="countPercentText">0%</p>
            </div>

            <br />
            <button class="btn btn-success" id="generate">Generate</button>
            <button class="btn btn-primary" id="download">Download a file with PLRs</button>
            <p id="error"></p>
        </div>

    </div>
    <div class="col-md-6 col-xs-12">
        <h2>Results</h2>
        <label>Resulted PLR will show here. <br /> This might take a few seconds.. <br /> Downloaded file will not show here. </label>
        <hr />
        <div id="output"></div>
    </div>
</div>

<div id="downloadInputModal" class="modal fade" role="dialog">
    <div class="modal-dialog">

        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Options</h4>
            </div>
            <div class="modal-body">
                <label for="numberOfSquares">How many PLRs you want generated?</label>
                <input class="form-control margin-bottom-10" type="number" id="numberOfSquares" placeholder="Number of PLRs" />
                <p style="color:#4477bb;font-weight:bold;" id="workingLabel" class="hidden">working on it...</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="downloadSquares">Download</button>
                <button type="button" class="btn btn-default" data-dismiss="modal" id="closeModal">Cancel</button>
            </div>
        </div>

    </div>
</div>

@section scripts{
    <script>
        var sendButton = "<button class='btn btn-danger margin-top-10' id='investigate'>Investigate</button>", recData;

        $(document).ready(function () {
            $("#generate").click(function () {
                let rows = $("#rows").val();
                let cols = $("#cols").val();
                let symbols = $("#symbols").val();
                let count = $("#count").val();

                if (rows == "") $("#rows").addClass("error");
                else $("#rows").removeClass("error");

                if (cols == "") $("#cols").addClass("error");
                else $("#cols").removeClass("error");

                if (symbols == "") $("#symbols").addClass("error");
                else $("#symbols").removeClass("error");

                if (count == "") $("#count").addClass("error");
                else $("#count").removeClass("error");

                if (rows == "" || cols == "" || symbols == "" || count == "") {
                    $("#error").html("please fill in all the parameters");
                    return;
                }

                if (Number(rows) > Number(symbols) ||
                    Number(cols) > Number(symbols)) {
                    $("#rows").addClass("error");
                    $("#symbols").addClass("error");
                    $("#error").html("can't have more rows and columns than symbols");
                    return;
                }

                if (Number(count) > Number(rows) * Number(cols)) {
                    $("#count").addClass("error");
                    $("#error").html("come on buddy..");
                    return;
                }

                $("#error").html('');

                $.ajax({
                    url: "/api/GetFullRectangle?rows=" + rows + "&cols=" + cols + "&symbols=" + symbols + "&count=" + count,
                    type: "get",
                    success: function (data) {
                        recData = data;
                        $("#output").html(data + sendButton);
                    },
                    error: function (err) {
                        console.log(err);
                    }
                });
            });

            $("#download").click(function () {
                let rows = $("#rows").val();
                let cols = $("#cols").val();
                let symbols = $("#symbols").val();
                let count = $("#count").val();

                if (rows == "") $("#rows").addClass("error");
                else $("#rows").removeClass("error");

                if (cols == "") $("#cols").addClass("error");
                else $("#cols").removeClass("error");

                if (symbols == "") $("#symbols").addClass("error");
                else $("#symbols").removeClass("error");

                if (count == "") $("#count").addClass("error");
                else $("#count").removeClass("error");

                if (rows == "" || cols == "" || symbols == "" || count == "") {
                    $("#error").html("please fill in all the parameters");
                    return;
                }

                if (Number(rows) > Number(symbols) ||
                    Number(cols) > Number(symbols)) {
                    $("#rows").addClass("error");
                    $("#symbols").addClass("error");
                    $("#error").html("can't have more rows and columns than symbols");
                    return;
                }

                if (Number(count) > Number(rows) * Number(cols)) {
                    $("#count").addClass("error");
                    $("#error").html("come on buddy..");
                    return;
                }

                $("#error").html('');
                $("#downloadInputModal").modal('show');
            });

            $("#downloadSquares").click(function () {
                let squares = $("#numberOfSquares").val();
                if (squares == "") {
                    $("#numberOfSquares").addClass("error");
                    return;
                }
                else {
                    $("#numberOfSquares").removeClass("error");
                    $("#workingLabel").html('working on it...');
                    $("#workingLabel").removeClass('hidden');
                }
                let rows = $("#rows").val();
                let cols = $("#cols").val();
                let symbols = $("#symbols").val();
                let count = $("#count").val();

                $.ajax({
                    url: "/api/GetFullRectanglesFile?rows=" + rows + "&cols=" + cols + "&symbols=" + symbols + "&count=" + count + "&squares=" + squares,
                    type: "get",
                    success: function (data) {
                        $("#workingLabel").html('done!');
                        download(data, "rectangles", "txt");
                    },
                    error: function (err) {
                        console.log(err);
                    }
                });

            });

            $(document).on('click', '.matrix-cell', function () {
                $(".matrix-cell").css("font-weight", "");
                $(".matrix-cell").css("color", "");
                let classes = $(this).attr('class').split(/\s+/);
                $.each(classes, function (index, item) {
                    if (item == "matrix-cell") return;
                    $("." + item).css("font-weight", "bold");
                    $("." + item).css("color", "#c55");
                });
            });

            $("#countPercent").change(function () {
                $("#countPercentText").text($(this).val() + "%");
                let rows = $("#rows").val();
                let cols = $("#cols").val();
                if (isNaN(rows) || isNaN(cols) || !rows || !cols) {
                    return;
                } 
                let size = Number(rows) * Number(cols);
                let val = Number($(this).val());
                let count = size * (val / 100);
                $("#count").val(parseInt(count));
            });

            $("#count").change(function () {
                let rows = $("#rows").val();
                let cols = $("#cols").val();
                if (isNaN(rows) || isNaN(cols) || !rows || !cols) {
                    return;
                } 
                let size = Number(rows) * Number(cols);
                let val = Number($(this).val());
                $("#countPercent").val(parseInt(val / size * 100)).change();
            });

            $(document).on('click', '#investigate', function () {
                location.href = "/home/investigation?r=" + Base64.encode(recData);
            });
        });
    </script>
}

